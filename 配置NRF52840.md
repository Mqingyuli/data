# gi配置NRF52840

[toc]

## 1.GPIO API接口

```c
//输入模式可以配置为没有pull，有上拉电阻，有下拉电阻，悬浮等4种状态
#include "nrf_gpio.h"//头文件

nrf_gpio_range_cfg_output(uint32_t pin_range_start, uint32_t pin_range_end);
//配置多个IO引脚为输出模式

nrf_gpio_range_cfg_input(uint32_t pin_range_start, uint32_t pin_range_end, nrf_gpio_pin_pull_t pull_config)  //配置多个IO引脚为输入模式
     
nrf_gpio_cfg_output(uint32_t pin_number)  //设置一个引脚输出模式
//没有电平检测；驱动能力是最低等级；没有上下拉；没有启动input buffer；输出；

nrf_gpio_cfg_input(uint32_t pin_number, nrf_gpio_pin_pull_t pull_config)//设置一个引脚输入模式没有电平检测；驱动能力是最低等级；上下拉根据传入参数而定；启动input buffer；输入；
    
nrf_gpio_pin_set(uint32_t pin_number)  //设置某个引脚为高电平

nrf_gpio_pin_clear(uint32_t pin_number)//设置某个引脚为低电平

nrf_gpio_pin_toggle(uint32_t pin_number)//翻转某个引脚的电平

nrf_gpio_pin_write(uint32_t pin_number, uint32_t value) //写某个引脚的电平，可以写高，也可以写低

nrf_gpio_pin_read(uint32_t pin_number) //读取某个引脚的电平
```

## 2.延时函数

```c
#include "nrf_delay.h" //头文件
void nrf_delay_us(us_time);  
void nrf_delay_ms(uint32_t ms_time);  
```



## 3.中断

### 3.1中断引脚配置

```c
/*使用GPIOTE中断需要先初始化GPIOTE*/
/*初始化函数nrf_drv_gpiote.h文件里，可以从引脚配置定义跳转*/
/*
NRFX_GPIOTE_CONFIG_IN_SENSE_LOTOHI(上升沿触发)
NRFX_GPIOTE_CONFIG_IN_SENSE_HITOLO(下降沿触发)
NRFX_GPIOTE_CONFIG_IN_SENSE_TOGGLE(上升沿下降沿均可触发)
*/
nrfx_gpiote_in_config_t button_config =NRFX_GPIOTE_CONFIG_IN_SENSE_HITOLO(true);
//创建引脚配置结构

button_config.pull = GPIO_PIN_CNF_PULL_Pullup;
//设置上拉

APP_ERROR_CHECK(nrfx_gpiote_in_init(PIN_1, &button_config, gpio_irq_handle));//绑定引脚1
APP_ERROR_CHECK(nrfx_gpiote_in_init(PIN_2, &button_config, gpio_irq_handle));//绑定引脚2
//按键绑定中断回调函数  gpio_irq_handle中断回调函数 如有多个引脚则需要绑定多次 回调函数可以同一个

nrfx_gpiote_in_event_enable(PIN_1, true);//使能引脚一
nrfx_gpiote_in_event_enable(PIN_2, true);//使能引脚二
//使能引脚 如有多个引脚则需要绑定多次
```

### 3.2中断函数配置

```c
void BTN_pin_handler(nrf_drv_gpiote_pin_t pin, nrf_gpiote_polarity_t action)//BTN_pin_handler函数名可更改，参数不可更改
{
    /******
    	code
    ********/
    
}
```



## 4.GPIOTE操作

### 4.1GPIOTE输出



![GPIOTE输出流程图](https://img-blog.csdnimg.cn/2018122519091158.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODc3MTI1,size_16,color_FFFFFF,t_70)

```c
ret_code_t err_code;
//初始化 GPIOTE 程序模块
err_code = nrf_drv_gpiote_init();
//出错函数
APP_ERROR_CHECK(err_code);
//定义 GPIOTE 输出初始化结构体，并对其成员变量赋值
nrf_drv_gpiote_out_config_t config = GPIOTE_CONFIG_OUT_TASK_TOGGLE(true);
//初始化 GPIOTE 输出引脚  参数一：引脚 参数二：初始化的结构体
err_code = nrf_drv_gpiote_out_init(LED_1, &config);
//出错函数
APP_ERROR_CHECK(err_code);
//使能引脚 pin所在 GPIOTE 通道的任务触发
nrf_drv_gpiote_out_task_enable(pin);
while (true)
{
    //任务触发驱动引脚 pin 状态翻转，即指示灯 D1 翻转状态
    nrf_drv_gpiote_out_task_trigger(pin);
    //任务触发驱动引脚 pin 输出高电平，即指示灯 D1 熄灭
    //nrf_drv_gpiote_clr_task_trigger(pin);
    //任务触发驱动引脚 pin 输出低电平，即指示灯 D1 电亮
    //nrf_drv_gpiote_set_task_trigger(pin);
    nrf_delay_ms(150);
}
```

### 4.2GPIOTE输入

​			                                                        ![在这里插入图片描述](https://img-blog.csdnimg.cn/20181225191604389.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODc3MTI1,size_16,color_FFFFFF,t_70)

```c
void in_pin_handler(nrf_drv_gpiote_pin_t pin, nrf_gpiote_polarity_t action)
{
nrf_drv_gpiote_out_toggle(LED_1);
}

ret_code_t err_code;
//初始化 GPIOTE 程序模块
err_code = nrf_drv_gpiote_init();
APP_ERROR_CHECK(err_code);
//定义 GPIOTE 输出初始化结构体，并对其成员变量赋值
nrf_drv_gpiote_out_config_t out_config =
    GPIOTE_CONFIG_OUT_SIMPLE(true);
//初始化 GPIOTE 输出引脚
err_code = nrf_drv_gpiote_out_init(LED_1, &out_config);
APP_ERROR_CHECK(err_code);

//高电平到低电平变化产生事件
nrf_drv_gpiote_in_config_t in_config = GPIOTE_CONFIG_IN_SENSE_HITOLO(true);

//低电平到高电平变化产生事件
//nrf_drv_gpiote_in_config_t in_config = GPIOTE_CONFIG_IN_SENSE_LOTOHI(true);

//任意电平变化产生事件
//nrf_drv_gpiote_in_config_t in_config = GPIOTE_CONFIG_IN_SENSE_TOGGLE(true);

//开启 P0.13 引脚的上拉电阻
in_config.pull = NRF_GPIO_PIN_PULLUP;
//配置该引脚为 GPIOTE 输入
err_code = nrf_drv_gpiote_in_init(BUTTON_0, &in_config, in_pin_handler);
APP_ERROR_CHECK(err_code);
//使能该引脚所在 GPIOTE 通道的事件模式
nrf_drv_gpiote_in_event_enable(BUTTON_0, true);
while (true)
{
}
```


